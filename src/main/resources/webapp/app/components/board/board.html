<div id="board-outer" *ngIf="boardData.initialized" (window:resize)="onResize($event)" [style.width]="width" (click)="hideMenus()">
    <div id="board-inner" [style.height]="boardHeight">
        <table class="board">
            <thead>

            <!--
                If we are not categorised, only the top headers will exist
            -->
            <tr *ngIf="!categorised">
                <th *ngFor="#header of topHeaders"
                    [attr.colspan]="header.cols"
                    [attr.rowspan]="header.rows"
                    [ngClass]="header.visible ? 'visible' : 'collapsed'"
                    (click)="toggleHeaderVisibility(header)">
                    <div [hidden]="!header.visible">{{header.name}} ({{header.totalIssues}})</div>
                    <div [hidden]="header.visible">{{header.totalIssues}}</div>
                </th>
            </tr>

            <!--
                If we are categorised, we will have two levels of headers. The top level will typically be the category,
                and the bottom level the states.

                Note that states which do not belong to a category will appear in the top
                row, with a rowspan of 2. Only these states will have a class in the top header since this class
                sets the width depending on if it is visible or collapsed
             -->
            <tr *ngIf="categorised">
                <th *ngFor="#header of topHeaders"
                    [attr.colspan]="header.cols"
                    [attr.rowspan]="header.rows"
                    [ngClass]="header.stateAndCategory ? header.visible ? 'visible' : 'collapsed' : ''"
                    (click)="toggleHeaderVisibility(header)">
                    <div [hidden]="!header.visible">{{header.name}} ({{header.totalIssues}})</div>
                    <div [hidden]="header.visible">{{header.totalIssues}}</div>
                </th>
            </tr>

            <tr *ngIf="categorised">
                <th *ngFor="#header of bottomHeaders"
                    [attr.colspan]="header.cols"
                    [attr.rowspan]="header.rows"
                    [ngClass]="header.visible ? 'visible' : 'collapsed'"
                    (click)="toggleHeaderVisibility(header)">
                    <div [hidden]="!header.visible">{{header.name}} ({{header.totalIssues}})</div>
                    <div [hidden]="header.visible">{{header.totalIssues}}</div>
                </th>
            </tr>


            </thead>
            <tbody *ngIf="!boardData.swimlane" [style.height]="boardBodyHeight">
            <tr>
                <td *ngFor="#state of boardStates ; #stateIndex=index"
                    [ngClass]="visibleColumns[stateIndex] == true ? 'visible' : 'collapsed'"
                    title="State: {{state}}">
                    <div [hidden]="!visibleColumns[stateIndex]">
                        <ul class="issues-list">
                            <issue *ngFor="#issue of boardData.issueTable[stateIndex]"
                                   [issue]="issue" (issueContextMenu)="showIssueContextMenu($event)"></issue>
                        </ul>
                    </div>
                    <div class="collapsed state-summary" [hidden]="visibleColumns[stateIndex]" *ngFor="#character of toCharArray(state)">{{character}}</div>
                </td>
            </tr>
            </tbody>
            <tbody *ngIf="boardData.swimlane"  [style.height]="boardBodyHeight">
            <swimlane-entry *ngFor="#swimlane of boardData.swimlaneTable; #swimlaneIndex=index"
                            [boardData]="boardData"
                            [swimlaneIndex]="swimlaneIndex"
                            [swimlane]="swimlane"
                            [hidden]="swimlane.filtered"
                            (issueContextMenu)="showIssueContextMenu($event)"></swimlane-entry>
            </tbody>
        </table>
    </div>
</div>
<!-- The panel with links to the control and health panels -->
<panel-menu></panel-menu>
<issue-context-menu [data]="issueContextMenuData" (closeContextMenu)="onCloseIssueContextMenu($event)"></issue-context-menu>